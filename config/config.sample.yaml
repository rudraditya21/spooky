version: 1

listen:
    protocol: http3
    address: "0.0.0.0"
    port: 9889
    tls:
        cert: certs/proxy-fullchain.pem # path to cert
        key: certs/proxy-key-pkcs8.pem # path to key

upstream:
  api_pool:
    load_balancing:
        type: "consistent-hash"

    route:
      path_prefix: "/api"

    backends:
      - id: "backend1"
        address: "127.0.0.1:7001"
        weight: 100
        health_check:
          path: "/health"
          interval: 5000

      - id: "backend2"
        address: "127.0.0.1:7002"
        weight: 50
        health_check:
          path: "/status"
          interval: 10000

  auth_pool:
    load_balancing:
      type: round-robin

    route:
      path_prefix: "/auth"

    backends:
      - id: "auth1"
        address: "127.0.0.1:8001"
        weight: 100
        health_check:
          path: "/health"
          interval: 5000

load_balancing:
    type: "random"   # global fallback: random, consistent-hash, round-robin

log:
    level: info